#!/bin/sh
GREEN='\e[092m'
STOP='\e[0m'

if [ "$1" = "-d" ] ; then 
    chezmoi git diff --staged
    exit 0
fi


echo "${GREEN}INFO${STOP}: ""chezmoi re-add all trackfile"
cd ~
chezmoi re-add


echo "${GREEN}INFO${STOP}: ""Add File to source"
# exit
temp=$(chezmoi source-path)
cd $temp
git add .

echo "${GREEN}INFO${STOP}: ""Are you sure commit with this change?"
if [ -z "$1" ]; then
    MEG="Update time: "`date '+%Y-%m-%d %H:%M'`
else
    MEG="$*"
fi
echo
git status --short --branch
echo
echo "${GREEN}Commit message${STOP}:"
echo "    $MEG"
echo

while true; do
    echo "Are you sure to commit?"
    read -p "pls input (y) to continue: " input
    if [ "$input" = "y" ]; then
        break
    fi
done

echo
echo "${GREEN}INFO${STOP}: ""OK, now commit "
echo
git commit -m "$MEG"
git log HEAD -n1 --stat --oneline


echo
echo "${GREEN}INFO${STOP}: ""Push to git"
echo
while true; do
    echo "Are you sure to push?"
    read -p "pls input (y) to continue: " input
    if [ "$input" = "y" ]; then
        break
    fi
done
echo
echo "${GREEN}INFO${STOP}: ""OK, now commit "
echo
git push
